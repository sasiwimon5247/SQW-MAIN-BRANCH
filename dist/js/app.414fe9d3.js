(function(){"use strict";var t={539:function(t,e,a){var i=a(5130),n=a(6768),l=a(4232);const s={id:"app"},r={class:"app-header"},o={class:"navbar"},c={class:"control-section"},d={style:{"margin-top":"8px",background:"#fff1",padding:"8px","border-radius":"8px"}},u=["value"],h={style:{"font-size":"12px"}},p={class:"checkbox-label"},m={class:"checkmark"},g={class:"opacity-control"},y={class:"opacity-value"},f={class:"flex-container"},b={class:"dashboard land-plots"},v={class:"dashboard-number"},w={class:"dashboard area"},k={class:"dashboard-number"},L={class:"flex-container"},M={class:"dashboard value"},x={class:"dashboard-number"},P={class:"action-buttons"},S={class:"form-section"},D={key:0},C={key:1},U={class:"form-row",style:{display:"flex",gap:"10px","flex-wrap":"nowrap"}},I={style:{flex:"1","max-width":"50%"}},F={style:{flex:"1","max-width":"50%"}},O={style:{display:"flex",gap:"5px"}},R={class:"form-group",style:{display:"flex",gap:"10px"}},N={class:"form-group"},E=["value"],z={class:"form-group"},T=["value"],A={class:"form-group",style:{display:"flex",gap:"10px"}},B={class:"form-group"},W=["disabled"],_={class:"form-group"},$=["disabled"],K={class:"form-group",style:{display:"flex",gap:"10px"}},V={class:"form-group"},X={class:"form-group"},j={class:"form-group"},G={class:"form-group"},H={key:0},q={key:1},J={class:"form-subtitle"},Q={key:0,class:"land-list"},Y=["onClick"],Z={class:"land-details"},tt=["onClick"],et={key:1,class:"no-data"},at={class:"main-content"},it={class:"map-container"},nt={class:"map-controls"},lt={key:0,class:"notification-badge"},st={class:"search-panel"},rt={class:"panel-header"},ot={class:"filters-panel"},ct={class:"panel-header"},dt={class:"filter-group"},ut={class:"form-group",style:{display:"flex",gap:"10px"}},ht={class:"filter-group"},pt={class:"price-range"},mt=["value"],gt=["value"],yt={class:"filter-group"},ft={class:"price-range"},bt=["value"],vt=["value"],wt={class:"filter-group"},kt={class:"price-range",style:{display:"flex",gap:"10px"}},Lt=["value"],Mt=["value"],xt={class:"filter-group"},Pt={class:"price-range",style:{display:"flex",gap:"10px"}},St=["value"],Dt=["value"],Ct={class:"filter-group"},Ut={class:"price-range",style:{display:"flex",gap:"10px"}},It=["value"],Ft=["value"],Ot={class:"flex gap-2"},Rt={class:"layers-panel"},Nt={class:"panel-header"},Et={class:"checkbox-label"},zt=["onUpdate:modelValue"],Tt={class:"chat-popup"},At={class:"chat-header"},Bt={class:"chat-title"},Wt={class:"text-xs opacity-70"},_t={key:0,class:"user-profile"},$t={key:1,class:"rooms-pane"},Kt={class:"rooms-head"},Vt={class:"badge"},Xt={key:0,class:"empty-state"},jt={key:1,class:"user-list"},Gt=["onClick","title"],Ht={class:"name"},qt={key:2,class:"chat-pane"},Jt={class:"chat-subheader"},Qt={class:"peer-name"},Yt={class:"chat-body",ref:"chatBody"},Zt={class:"bubble"},te={key:0,class:"meta"},ee={class:"timestamp"},ae={class:"text"},ie={key:0,class:"no-messages"},ne={key:0,class:"typing-indicator"},le={class:"chat-input-row"},se=["disabled"],re=["disabled"];function oe(t,e,a,oe,ce,de){const ue=(0,n.g2)("LoginBar");(0,n.g2)("RouterView");return(0,n.uX)(),(0,n.CE)("div",s,[(0,n.Lk)("header",r,[e[71]||(e[71]=(0,n.Lk)("h1",null,"SQW",-1)),(0,n.bF)(ue),(0,n.Q3)("",!0)]),(0,n.Lk)("nav",o,[(0,n.Lk)("div",c,[(0,n.Lk)("div",d,[(0,n.Lk)("button",{onClick:e[0]||(e[0]=e=>t.addBangkokOverlay())},"ผังเมือง กทม. 2556"),(0,n.Lk)("button",{onClick:e[1]||(e[1]=e=>t.addBangkokOverlayDaft())}," ผังเมือง กทม. 2570 (ร่าง) "),(0,n.Lk)("button",{onClick:e[2]||(e[2]=e=>t.clearBangkokOverlay())},"ซ่อนผังเมือง"),e[72]||(e[72]=(0,n.Lk)("label",{style:{display:"block","font-size":"12px",opacity:"0.8"}},"Opacity (ผัง กทม.)",-1)),(0,n.Lk)("input",{type:"range",min:"0",max:"1",step:"0.05",value:t.kmlOpacity,onInput:e[3]||(e[3]=e=>t.setBangkokOverlayOpacity(e.target.value))},null,40,u),(0,n.Lk)("span",h,(0,l.v_)(t.kmlOpacity.toFixed(2)),1)]),(0,n.Lk)("label",p,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=e=>t.dolEnabled=e),onChange:e[5]||(e[5]=(...e)=>t.onToggleDol&&t.onToggleDol(...e))},null,544),[[i.lH,t.dolEnabled]]),(0,n.Lk)("span",m,(0,l.v_)(t.dolEnabled?"✓":""),1),e[73]||(e[73]=(0,n.eW)(" ระวางกรมที่ดินสีแดง ",-1))]),(0,n.Lk)("div",g,[e[74]||(e[74]=(0,n.Lk)("label",null,"Opacity",-1)),(0,n.bo)((0,n.Lk)("input",{type:"range",min:"0",max:"1",step:"0.01","onUpdate:modelValue":e[6]||(e[6]=e=>t.opacity=e),class:"slider",onInput:e[7]||(e[7]=(...e)=>t.onChangeDolOpacity&&t.onChangeDolOpacity(...e))},null,544),[[i.Jo,t.opacity]]),(0,n.Lk)("span",y,(0,l.v_)(t.opacity),1)])]),(0,n.Lk)("div",f,[(0,n.Lk)("div",b,[(0,n.Lk)("span",v,[(0,n.eW)((0,l.v_)(t.dashboard.plots.toLocaleString())+" ",1),e[75]||(e[75]=(0,n.Lk)("span",{class:"highlight"},"ประกาศ",-1))]),e[76]||(e[76]=(0,n.Lk)("div",{class:"dashboard-label"},"ที่ดินทั้งหมด",-1))]),(0,n.Lk)("div",w,[(0,n.Lk)("span",k,[(0,n.eW)((0,l.v_)(t.fmt2(t.dashboard.areaRai)),1),e[77]||(e[77]=(0,n.Lk)("span",{class:"highlight"}," ไร่",-1))]),e[78]||(e[78]=(0,n.Lk)("div",{class:"dashboard-label"},"จำนวนรวม",-1))])]),(0,n.Lk)("div",L,[(0,n.Lk)("div",M,[(0,n.Lk)("span",x,(0,l.v_)(t.fmt(t.dashboard.totalValueMillion)),1),e[79]||(e[79]=(0,n.Lk)("div",{class:"dashboard-label"},[(0,n.Lk)("span",{class:"highlight"},"ล้านบาท")],-1)),e[80]||(e[80]=(0,n.Lk)("div",{class:"dashboard-label"},"มูลค่าที่ดินรวม",-1))])]),(0,n.Lk)("div",P,[(0,n.Lk)("button",{class:"btn btn-info",onClick:e[8]||(e[8]=(...e)=>t.startDrawing&&t.startDrawing(...e))}," เริ่มวาดขอบเขต "),(0,n.Lk)("button",{class:"btn btn-success",onClick:e[9]||(e[9]=(...e)=>t.finishDrawing&&t.finishDrawing(...e))},"Finish"),(0,n.Lk)("button",{class:"btn btn-danger",onClick:e[10]||(e[10]=(...e)=>t.clearDrawing&&t.clearDrawing(...e))},"Clear")]),(0,n.Lk)("div",S,[(0,n.Lk)("h3",{onClick:e[11]||(e[11]=e=>t.isFormOpen=!t.isFormOpen),style:{cursor:"pointer"}},[e[81]||(e[81]=(0,n.eW)(" ข้อมูลแปลง (พื้นดิน) ",-1)),t.isFormOpen?((0,n.uX)(),(0,n.CE)("span",D,"▲")):((0,n.uX)(),(0,n.CE)("span",C,"▼"))]),(0,n.bF)(i.eB,{name:"fade"},{default:(0,n.k6)(()=>[(0,n.bo)((0,n.Lk)("div",null,[e[94]||(e[94]=(0,n.Lk)("div",{class:"form-subtitle"},"ข้อมูลการประเมินแปลง",-1)),e[95]||(e[95]=(0,n.Lk)("div",{class:"form-subtitle"},"ระบบสามารถให้ข้อมูลอัตโนมัติ",-1)),(0,n.Lk)("div",U,[(0,n.Lk)("div",I,[e[82]||(e[82]=(0,n.Lk)("label",{class:"form-group"},"ขนาดที่ดิน (ตร.วา)",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text",inputmode:"decimal","onUpdate:modelValue":e[12]||(e[12]=e=>t.landData.size=e),onInput:e[13]||(e[13]=e=>{t.landData.size=t.sanitizeDecimal(e.target.value),t.syncFromSize(),t.landData.price&&t.syncPriceFromPerSqw()}),onBlur:e[14]||(e[14]=e=>{t.landData.size=t.formatLandSize(t.landData.size),t.syncFromSize()}),class:"form-input text-center",placeholder:"0"},null,544),[[i.Jo,t.landData.size]])]),(0,n.Lk)("div",F,[e[83]||(e[83]=(0,n.Lk)("label",{class:"form-group"},"ขนาดที่ดิน (ไร่/งาน/วา)",-1)),(0,n.Lk)("div",O,[(0,n.bo)((0,n.Lk)("input",{class:"form-input text-center",style:{width:"33.33%"},inputmode:"numeric","onUpdate:modelValue":e[15]||(e[15]=e=>t.raiModel=e),onInput:e[16]||(e[16]=e=>t.onRNWInput()),onBlur:e[17]||(e[17]=e=>t.normalizeRNW()),placeholder:"0"},null,544),[[i.Jo,t.raiModel]]),(0,n.bo)((0,n.Lk)("input",{class:"form-input text-center",style:{width:"33.33%"},inputmode:"numeric","onUpdate:modelValue":e[18]||(e[18]=e=>t.nganModel=e),onInput:e[19]||(e[19]=e=>t.onRNWInput()),onBlur:e[20]||(e[20]=e=>t.normalizeRNW()),placeholder:"0"},null,544),[[i.Jo,t.nganModel]]),(0,n.bo)((0,n.Lk)("input",{class:"form-input text-center",style:{width:"33.33%"},inputmode:"decimal","onUpdate:modelValue":e[21]||(e[21]=e=>t.wahModel=e),onInput:e[22]||(e[22]=e=>{t.wahModel=t.sanitizeDecimal(e.target.value),t.onRNWInput()}),onBlur:e[23]||(e[23]=e=>{t.wahModel=t.formatLandSize(t.wahModel),t.normalizeRNW()}),placeholder:"0"},null,544),[[i.Jo,t.wahModel]])])])]),e[96]||(e[96]=(0,n.Lk)("div",null,null,-1)),(0,n.Lk)("div",R,[(0,n.Lk)("div",N,[e[84]||(e[84]=(0,n.Lk)("label",{class:"form-group"},"หน้ากว้างติดถนน (M)",-1)),(0,n.Lk)("input",{type:"text",inputmode:"numeric",value:t.formatNumber(t.landData.width),onInput:e[24]||(e[24]=e=>t.landData.width=t.unformatNumber(e.target.value)),class:"form-input",placeholder:"0"},null,40,E)]),(0,n.Lk)("div",z,[e[85]||(e[85]=(0,n.Lk)("label",{class:"form-group"},"ขนาดถนน (M)",-1)),(0,n.Lk)("input",{type:"text",inputmode:"numeric",value:t.formatNumber(t.landData.road),onInput:e[25]||(e[25]=e=>t.landData.road=t.unformatNumber(e.target.value)),class:"form-input",placeholder:"0"},null,40,T)])]),(0,n.Lk)("div",A,[(0,n.Lk)("div",null,[e[86]||(e[86]=(0,n.Lk)("label",{class:"form-group"},"ราคาต่อตารางวา",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text",inputmode:"decimal","onUpdate:modelValue":e[26]||(e[26]=e=>t.landData.price=e),onInput:e[27]||(e[27]=e=>{t.landData.price=t.sanitizeDecimal(t.landData.price),t.syncPriceFromPerSqw()}),onBlur:e[28]||(e[28]=e=>t.landData.price=t.formatPrice(t.landData.price)),class:"form-input text-center",placeholder:"0"},null,544),[[i.Jo,t.landData.price]])]),(0,n.Lk)("div",null,[e[87]||(e[87]=(0,n.Lk)("label",{class:"form-group"},"ราคารวม",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text",inputmode:"decimal","onUpdate:modelValue":e[29]||(e[29]=e=>t.landData.totalPrice=e),onInput:e[30]||(e[30]=e=>{t.landData.totalPrice=t.sanitizeDecimal(t.landData.totalPrice),t.syncPerSqwFromTotal()}),onBlur:e[31]||(e[31]=e=>t.landData.totalPrice=t.formatPrice(t.landData.totalPrice)),class:"form-input text-center",placeholder:"0"},null,544),[[i.Jo,t.landData.totalPrice]])])]),(0,n.Lk)("div",B,[e[88]||(e[88]=(0,n.Lk)("label",{class:"form-group"},"เจ้าของ",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":e[32]||(e[32]=e=>t.landData.owner=e),placeholder:"ชื่อเจ้าของ",class:"form-input",disabled:!(!t.landData.agent||!t.landData.agent.trim())},null,8,W),[[i.Jo,t.landData.owner]])]),(0,n.Lk)("div",_,[e[89]||(e[89]=(0,n.Lk)("label",{class:"form-group"},"นายหน้า",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":e[33]||(e[33]=e=>t.landData.agent=e),placeholder:"ชื่อนายหน้า",class:"form-input",disabled:!(!t.landData.owner||!t.landData.owner.trim())},null,8,$),[[i.Jo,t.landData.agent]])]),(0,n.Lk)("div",K,[(0,n.Lk)("div",V,[e[90]||(e[90]=(0,n.Lk)("label",{class:"form-group"},"โทร",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":e[34]||(e[34]=e=>t.landData.phone=e),placeholder:"08x-xxx-xxxx",class:"form-input"},null,512),[[i.Jo,t.landData.phone]])]),(0,n.Lk)("div",X,[e[91]||(e[91]=(0,n.Lk)("label",{class:"form-group"},"LINE ID",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":e[35]||(e[35]=e=>t.landData.lineId=e),placeholder:"@lineid หรือ lineid",class:"form-input"},null,512),[[i.Jo,t.landData.lineId]])])]),(0,n.Lk)("div",j,[e[92]||(e[92]=(0,n.Lk)("label",{class:"form-group"},"กรอบที่ดิน",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":e[36]||(e[36]=e=>t.landData.landFrame=e),placeholder:"กรอบที่ดิน",class:"form-input"},null,512),[[i.Jo,t.landData.landFrame]])]),(0,n.Lk)("div",G,[e[93]||(e[93]=(0,n.Lk)("label",{class:"form-group"},"ข้อมูลโฉนด/ระวาง",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":e[37]||(e[37]=e=>t.landData.deedInformation=e),placeholder:"ข้อมูลโฉนด/ระวาง",class:"form-input"},null,512),[[i.Jo,t.landData.deedInformation]])]),(0,n.Lk)("button",{style:{"margin-top":"30px"},class:"btn btn-primary btn-full",onClick:e[38]||(e[38]=(...e)=>t.saveLandData&&t.saveLandData(...e))}," บันทึกและปิด ")],512),[[i.aG,t.isFormOpen]])]),_:1}),e[98]||(e[98]=(0,n.Lk)("div",{class:"section-divider"},null,-1)),(0,n.Lk)("h3",{onClick:e[39]||(e[39]=e=>t.isListOpen=!t.isListOpen),style:{cursor:"pointer"}},[e[97]||(e[97]=(0,n.eW)(" รายการแปลง ",-1)),t.isListOpen?((0,n.uX)(),(0,n.CE)("span",H,"▲")):((0,n.uX)(),(0,n.CE)("span",q,"▼"))]),(0,n.bF)(i.eB,{name:"fade"},{default:(0,n.k6)(()=>[(0,n.bo)((0,n.Lk)("div",null,[(0,n.Lk)("div",J," ข้อมูลรายการแปลงทั้งหมดของคุณ "+(0,l.v_)(t.savedLands.length)+" แปลง ",1),t.savedLands.length>0?((0,n.uX)(),(0,n.CE)("div",Q,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.savedLands,(e,a)=>((0,n.uX)(),(0,n.CE)("div",{key:a,class:"land-item"},[(0,n.Lk)("div",{class:"land-owner",onClick:a=>t.focusLand(e)},(0,l.v_)(e.owner||e.agent+" (นายหน้า)"||0),9,Y),(0,n.Lk)("div",Z,(0,l.v_)(t.formatNumber(e.size))+" ตร.วา ",1),(0,n.Lk)("button",{style:{"margin-top":"6px",padding:"6px 10px",background:"#e11d48",color:"#fff",border:"0","border-radius":"6px"},onClick:a=>t.deleteLandItem(e.id)}," ลบแปลง ",8,tt)]))),128))])):((0,n.uX)(),(0,n.CE)("div",et,"ยังไม่มีข้อมูลแปลง"))],512),[[i.aG,t.isListOpen]])]),_:1})])]),(0,n.Lk)("main",at,[(0,n.Lk)("aside",it,[e[117]||(e[117]=(0,n.Lk)("div",{id:"map",style:{width:"100%",height:"100%"}},null,-1)),(0,n.Lk)("div",nt,[(0,n.Lk)("button",{class:"control-btn search-btn",onClick:e[40]||(e[40]=(...e)=>t.toggleSearch&&t.toggleSearch(...e)),title:"Search"},e[99]||(e[99]=[(0,n.Lk)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,n.Lk)("circle",{cx:"11",cy:"11",r:"8"}),(0,n.Lk)("path",{d:"m21 21-4.35-4.35"})],-1)])),(0,n.Lk)("button",{class:"control-btn filter-btn",onClick:e[41]||(e[41]=(...e)=>t.toggleFilters&&t.toggleFilters(...e)),title:"Filters"},e[100]||(e[100]=[(0,n.Lk)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,n.Lk)("polygon",{points:"22,3 2,3 10,12.46 10,19 14,21 14,12.46"})],-1)])),(0,n.Lk)("button",{class:(0,l.C4)(["control-btn p2p-btn",{"has-notification":t.hasNewMessage}]),onClick:e[42]||(e[42]=(...e)=>t.toggleP2P&&t.toggleP2P(...e)),title:"P2P Chat"},[e[101]||(e[101]=(0,n.Lk)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,n.Lk)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})],-1)),t.unreadCount>0?((0,n.uX)(),(0,n.CE)("span",lt,(0,l.v_)(t.unreadCount),1)):(0,n.Q3)("",!0)],2)]),(0,n.bo)((0,n.Lk)("div",st,[(0,n.Lk)("div",rt,[e[102]||(e[102]=(0,n.Lk)("h3",null,"ค้นหา",-1)),(0,n.Lk)("button",{onClick:e[43]||(e[43]=e=>t.showSearch=!1),class:"close-btn"},"×")]),(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":e[44]||(e[44]=e=>t.searchQuery=e),placeholder:"พิมพ์ชื่อสถานที่ หรือ 13.7563, 100.5018 (ปล่อยว่างเพื่อใช้ GPS)",class:"search-input"},null,512),[[i.Jo,t.searchQuery]]),(0,n.Lk)("button",{onClick:e[45]||(e[45]=(...e)=>t.performSearch&&t.performSearch(...e)),class:"btn btn-primary"},"ค้นหา"),(0,n.Lk)("button",{onClick:e[46]||(e[46]=(...e)=>t.locateByGPS&&t.locateByGPS(...e)),class:"btn btn-outline-secondary",style:{"margin-left":"8px"}}," ใช้ตำแหน่งฉัน (GPS) ")],512),[[i.aG,t.showSearch]]),(0,n.bo)((0,n.Lk)("div",ot,[(0,n.Lk)("div",ct,[e[103]||(e[103]=(0,n.Lk)("h3",null,"ตัวกรอง",-1)),(0,n.Lk)("button",{onClick:e[47]||(e[47]=e=>t.showFilters=!1),class:"close-btn"},"×")]),(0,n.Lk)("div",dt,[e[105]||(e[105]=(0,n.Lk)("label",null,"ขนาดถนน",-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":e[48]||(e[48]=e=>t.filters.roadWidth=e),class:"form-select"},e[104]||(e[104]=[(0,n.Fv)('<option value="">ทั้งหมด</option><option value="lt6">ต่ำกว่า 6 เมตร</option><option value="6-9.99">ตั้งแต่ 6–9.99 เมตร</option><option value="ge10">ตั้งแต่ 10 เมตรขึ้นไป</option><option value="ge18">ตั้งแต่ 18 เมตรขึ้นไป</option><option value="ge30">30 เมตรขึ้นไป</option>',6)]),512),[[i.u1,t.filters.roadWidth]])]),(0,n.Lk)("div",ut,[(0,n.Lk)("div",ht,[e[106]||(e[106]=(0,n.Lk)("label",null,"ขนาดพื้นที่ (ตร.วา)",-1)),(0,n.Lk)("div",pt,[(0,n.Lk)("input",{type:"text",value:t.formatNumber(t.filters.areaMin),onInput:e[49]||(e[49]=e=>t.filters.areaMin=t.unformatNumber(e.target.value)),placeholder:"ต่ำสุด",class:"price-input",style:{width:"50%"}},null,40,mt),(0,n.Lk)("input",{type:"text",value:t.formatNumber(t.filters.areaMax),onInput:e[50]||(e[50]=e=>t.filters.areaMax=t.unformatNumber(e.target.value)),placeholder:"สูงสุด",class:"price-input",style:{width:"50%"}},null,40,gt)])]),(0,n.Lk)("div",yt,[e[107]||(e[107]=(0,n.Lk)("label",null,"ขนาดพื้นที่ (ไร่)",-1)),(0,n.Lk)("div",ft,[(0,n.Lk)("input",{type:"text",value:t.formatNumber(t.filters.areaMinRai),onInput:e[51]||(e[51]=e=>t.filters.areaMinRai=t.unformatNumber(e.target.value)),placeholder:"ต่ำสุด",class:"price-input",style:{width:"50%"}},null,40,bt),(0,n.Lk)("input",{type:"text",value:t.formatNumber(t.filters.areaMaxRai),onInput:e[52]||(e[52]=e=>t.filters.areaMaxRai=t.unformatNumber(e.target.value)),placeholder:"สูงสุด",class:"price-input",style:{width:"50%"}},null,40,vt)])])]),(0,n.Lk)("div",wt,[e[108]||(e[108]=(0,n.Lk)("label",null,"ช่วงราคา (บาท : ตร.วา)",-1)),(0,n.Lk)("div",kt,[(0,n.Lk)("input",{type:"text",value:t.formatNumber(t.filters.priceMin),onInput:e[53]||(e[53]=e=>t.filters.priceMin=t.unformatNumber(e.target.value)),placeholder:"ต่ำสุด",class:"price-input",style:{width:"50%"}},null,40,Lt),(0,n.Lk)("input",{type:"text",value:t.formatNumber(t.filters.priceMax),onInput:e[54]||(e[54]=e=>t.filters.priceMax=t.unformatNumber(e.target.value)),placeholder:"สูงสุด",class:"price-input",style:{width:"50%"}},null,40,Mt)])]),(0,n.Lk)("div",xt,[e[109]||(e[109]=(0,n.Lk)("label",null,"ช่วงราคา (รวมทั้งแปลง)",-1)),(0,n.Lk)("div",Pt,[(0,n.Lk)("input",{type:"text",value:t.formatNumber(t.filters.totalPriceMin),onInput:e[55]||(e[55]=e=>t.filters.totalPriceMin=t.unformatNumber(e.target.value)),placeholder:"ต่ำสุด",class:"price-input",style:{width:"50%"}},null,40,St),(0,n.Lk)("input",{type:"text",value:t.formatNumber(t.filters.totalPriceMax),onInput:e[56]||(e[56]=e=>t.filters.totalPriceMax=t.unformatNumber(e.target.value)),placeholder:"สูงสุด",class:"price-input",style:{width:"50%"}},null,40,Dt)])]),(0,n.Lk)("div",Ct,[e[110]||(e[110]=(0,n.Lk)("label",null,"หน้ากว้างที่ดิน (เมตร)",-1)),(0,n.Lk)("div",Ut,[(0,n.Lk)("input",{type:"text",value:t.formatNumber(t.filters.frontMin),onInput:e[57]||(e[57]=e=>t.filters.frontMin=t.unformatNumber(e.target.value)),placeholder:"ต่ำสุด",class:"price-input",style:{width:"50%"}},null,40,It),(0,n.Lk)("input",{type:"text",value:t.formatNumber(t.filters.frontMax),onInput:e[58]||(e[58]=e=>t.filters.frontMax=t.unformatNumber(e.target.value)),placeholder:"สูงสุด",class:"price-input",style:{width:"50%"}},null,40,Ft)])]),(0,n.Lk)("div",Ot,[(0,n.Lk)("button",{class:"btn btn-primary",onClick:e[59]||(e[59]=(...e)=>t.applyFilters&&t.applyFilters(...e))}," ใช้ตัวกรอง "),(0,n.Lk)("button",{class:"btn btn-secondary",onClick:e[60]||(e[60]=(...e)=>t.resetFilters&&t.resetFilters(...e))}," ล้าง ")])],512),[[i.aG,t.showFilters]]),(0,n.bo)((0,n.Lk)("div",Rt,[(0,n.Lk)("div",Nt,[e[111]||(e[111]=(0,n.Lk)("h3",null,"Layers",-1)),(0,n.Lk)("button",{onClick:e[61]||(e[61]=e=>t.showLayers=!1),class:"close-btn"},"×")]),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.availableLayers,t=>((0,n.uX)(),(0,n.CE)("div",{class:"layer-item",key:t.id},[(0,n.Lk)("label",Et,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox","onUpdate:modelValue":e=>t.visible=e},null,8,zt),[[i.lH,t.visible]]),e[112]||(e[112]=(0,n.Lk)("span",{class:"checkmark"},"✓",-1)),(0,n.eW)(" "+(0,l.v_)(t.name),1)])]))),128))],512),[[i.aG,t.showLayers]]),(0,n.bo)((0,n.Lk)("div",Tt,[(0,n.Lk)("div",At,[(0,n.Lk)("div",Bt,[e[113]||(e[113]=(0,n.Lk)("h3",null,"P2P Chat",-1)),(0,n.Lk)("div",Wt," คุณ: "+(0,l.v_)(t.userProfile.name||"User-"+(t.currentUserId||"").slice(0,6)),1)]),(0,n.Lk)("button",{onClick:e[62]||(e[62]=e=>t.showChat=!1),class:"close-btn"},"×")]),t.userProfile.name?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",_t,[(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":e[63]||(e[63]=e=>t.tempUserName=e),placeholder:"กรุณาตั้งชื่อของคุณก่อน",class:"profile-input",onKeyup:e[64]||(e[64]=(0,i.jR)((...e)=>t.setUserProfile&&t.setUserProfile(...e),["enter"]))},null,544),[[i.Jo,t.tempUserName]]),(0,n.Lk)("button",{onClick:e[65]||(e[65]=(...e)=>t.setUserProfile&&t.setUserProfile(...e)),class:"btn btn-sm btn-primary"}," ตั้งชื่อ ")])),"rooms"===t.chatMode?((0,n.uX)(),(0,n.CE)("div",$t,[(0,n.Lk)("div",Kt,[e[114]||(e[114]=(0,n.Lk)("div",{class:"rooms-title"},"คนออนไลน์ (คลิกเพื่อคุย):",-1)),(0,n.Lk)("span",Vt,(0,l.v_)(t.onlineUsers.length),1)]),0===t.onlineUsers.length?((0,n.uX)(),(0,n.CE)("div",Xt," ยังไม่มีใครออนไลน์ ")):((0,n.uX)(),(0,n.CE)("div",jt,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.onlineUsers,a=>((0,n.uX)(),(0,n.CE)("button",{key:a.uid,class:"user-pill",onClick:e=>t.selectUserToChat(a),title:a.name||"User-"+a.uid.slice(0,6)},[e[115]||(e[115]=(0,n.Lk)("span",{class:"dot online"},null,-1)),(0,n.Lk)("span",Ht,(0,l.v_)(a.name||"User-"+a.uid.slice(0,6)),1)],8,Gt))),128))]))])):((0,n.uX)(),(0,n.CE)("div",qt,[(0,n.Lk)("div",Jt,[(0,n.Lk)("button",{class:"btn btn-xs",onClick:e[66]||(e[66]=(...e)=>t.backToRooms&&t.backToRooms(...e))},"← กลับ"),(0,n.Lk)("div",Qt,(0,l.v_)(t.selectedUser?.name||"User-"+(t.selectedUser?.uid||"").slice(0,6)),1)]),(0,n.Lk)("div",Yt,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.chatMessages,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:(0,l.C4)(["chat-msg",{me:e.fromUid===t.currentUserId,system:"system"===e.type}])},[(0,n.Lk)("div",Zt,[e.type?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",te,[(0,n.eW)((0,l.v_)(e.fromName)+" ",1),(0,n.Lk)("span",ee,(0,l.v_)(t.formatTime(e.createdAt)),1)])),(0,n.Lk)("div",ae,(0,l.v_)(e.text),1)])],2))),128)),0===t.chatMessages.length?((0,n.uX)(),(0,n.CE)("div",ie," เริ่มคุยกันเลย! ")):(0,n.Q3)("",!0)],512),t.showTypingIndicator?((0,n.uX)(),(0,n.CE)("div",ne,e[116]||(e[116]=[(0,n.Lk)("span",{class:"typing-dots"},[(0,n.Lk)("span"),(0,n.Lk)("span"),(0,n.Lk)("span")],-1),(0,n.eW)(" กำลังพิมพ์… ",-1)]))):(0,n.Q3)("",!0),(0,n.Lk)("div",le,[(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":e[67]||(e[67]=e=>t.chatInput=e),placeholder:"พิมพ์ข้อความ...",class:"chat-input",onKeyup:e[68]||(e[68]=(0,i.jR)((...e)=>t.sendMessage&&t.sendMessage(...e),["enter"])),onInput:e[69]||(e[69]=(...e)=>t.handleTyping&&t.handleTyping(...e)),disabled:!t.userProfile.name||!t.selectedUser},null,40,se),[[i.Jo,t.chatInput]]),(0,n.Lk)("button",{onClick:e[70]||(e[70]=(...e)=>t.sendMessage&&t.sendMessage(...e)),class:"btn btn-sm btn-primary send-btn",disabled:!t.chatInput.trim()||!t.userProfile.name||!t.selectedUser}," ส่ง ",8,re)])]))],512),[[i.aG,t.showChat]])])])])}a(4114),a(8111),a(2489),a(116),a(7588),a(1701),a(8237),a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698);var ce=a(6400),de=a(2215),ue=a(4388),he=a(1239);const pe={apiKey:"AIzaSyBDdOt1ajdsBOu7tVdcWOm3c_A61yvdytk",authDomain:"chattestproject-42024.firebaseapp.com",projectId:"chattestproject-42024",storageBucket:"chattestproject-42024.firebasestorage.app",messagingSenderId:"828044311671",appId:"1:828044311671:web:c6fe41d320716830591a72",measurementId:"G-6H2BLTSKLW",databaseURL:"https://chattestproject-42024-default-rtdb.asia-southeast1.firebasedatabase.app/"},me=(0,ce.Wp)(pe);let ge;try{ge=(0,de.P5)(me)}catch(He){}const ye=(0,ue.xI)(me),fe=(0,he.C3)(me);function be(t){return(0,ue.hg)(ye,t)}async function ve(){const t=new ue.HF,e=await(0,ue.df)(ye,t);return e.user}async function we(t,e){const a=await(0,ue.x9)(ye,t,e);return a.user}async function ke(t,e,a=""){const i=await(0,ue.eJ)(ye,t,e);return a&&await(0,ue.r7)(i.user,{displayName:a}),i.user}async function Le(){const t=ye.currentUser;t&&await xe(t.uid),await(0,ue.CI)(ye)}async function Me(t,e={}){if(!t)return;const a=(0,he.KR)(fe,`presence/${t}`);await(0,he.yo)(a,{uid:t,online:!0,lastSeen:(0,he.O5)(),...e}),(0,he.yX)(a).update({online:!1,lastSeen:(0,he.O5)()})}async function xe(t){if(!t)return;const e=(0,he.KR)(fe,`presence/${t}`);await(0,he.yo)(e,{online:!1,lastSeen:(0,he.O5)()})}function Pe(t){const e=(0,he.KR)(fe,"presence");return(0,he.Zy)(e,e=>{const a=e.val()||{},i=Date.now(),n=6e4,l=Object.values(a).filter(t=>{const e="number"===typeof t.lastSeen?t.lastSeen:0,a=!e||i-e<n;return t&&!0===t.online&&a});t(l)})}async function Se(t,e,a="",i){if(!i)throw new Error("sendChatMessage: ต้องระบุ toUid");const n=e,l=i,s=(0,he.KR)(fe,`privateChats/${n}/${l}/messages`),r=(0,he.KR)(fe,`privateChats/${l}/${n}/messages`),o={text:String(t||""),fromUid:n,fromName:a||`User-${n.slice(0,6)}`,createdAt:(0,he.O5)(),readBy:{[n]:!0}};await(0,he.VC)(s,o),await(0,he.VC)(r,o)}function De(t,e,a){if(!t||!e)return()=>{};const i=(0,he.KR)(fe,`privateChats/${t}/${e}/messages`);return(0,he.Zy)(i,t=>{const e=t.val()||{},i=Object.entries(e).map(([t,e])=>({id:t,...e}));i.sort((t,e)=>(t.createdAt||0)-(e.createdAt||0)),a(i)})}async function Ce(t,e){if(!t||!e)return;const a=`privateChats/${t}/${e}/messages`,i=await(0,he.Jt)((0,he.KR)(fe,a)),n=i.val()||{},l={};Object.keys(n).forEach(e=>{l[`${a}/${e}/readBy/${t}`]=!0}),Object.keys(l).length&&await(0,he.yo)((0,he.KR)(fe),l)}function Ue(t,e){const a=(0,he.KR)(fe,"presence");return(0,he.Zy)(a,a=>{const i=a.val()||{},n=Object.values(i).filter(e=>e.uid&&e.uid!==t).map(e=>({roomId:`${t}_${e.uid}`,otherUid:e.uid,otherName:e.name||`User-${e.uid.slice(0,6)}`,unreadCount:0,lastText:"",lastAt:0}));e(n)})}async function Ie(t,e){if(!t)throw new Error("saveLand: need uid");const a=(0,he.O5)(),i={...e,ownerUid:t,updatedAt:a};if(e.id)return await(0,he.yo)((0,he.KR)(fe,`lands/${t}/${e.id}`),i),await(0,he.yo)((0,he.KR)(fe,`landsPublic/${e.id}`),i),e.id;{const e=(0,he.VC)((0,he.KR)(fe,`lands/${t}`)),n=e.key,l={...i,id:n,createdAt:a};return await(0,he.yo)(e,l),await(0,he.yo)((0,he.KR)(fe,`landsPublic/${n}`),l),n}}async function Fe(t,e){if(!t||!e)throw new Error("deleteLand: need uid & landId");await(0,he.TF)((0,he.KR)(fe,`lands/${t}/${e}`)),await(0,he.TF)((0,he.KR)(fe,`landsPublic/${e}`))}function Oe(t){const e=(0,he.KR)(fe,"landsPublic");return(0,he.Zy)(e,e=>{const a=e.val()||{},i=Object.entries(a).map(([t,e])=>({id:t,...e}));t(i)})}var Re=a(144);const Ne={class:"login-bar",style:{display:"flex",gap:"0.75rem","align-items":"center","justify-content":"space-between",padding:"0.75rem 1rem"}},Ee={key:0},ze={key:1,style:{display:"flex",gap:"0.5rem","align-items":"center","flex-wrap":"wrap"}},Te={key:0,style:{color:"#b91c1c"}};var Ae={__name:"LoginBar",setup(t){const e=(0,Re.KR)(null),a=(0,Re.KR)(""),s=(0,Re.KR)(""),r=(0,Re.KR)("");let o=null;(0,n.sV)(()=>{o=be(async t=>{if(e.value=t||null,t){const e=t.displayName||(t.email?t.email.split("@")[0]:`User-${t.uid.slice(0,6)}`);await Me(t.uid,{name:e})}})}),(0,n.xo)(()=>{o&&o()});const c=(0,n.EW)(()=>e.value?.uid?e.value.uid.slice(0,6):"");async function d(){r.value="";try{await ve()}catch(t){r.value=m(t)}}async function u(){r.value="";try{await we(a.value,s.value)}catch(t){r.value=m(t)}}async function h(){r.value="";try{await ke(a.value,s.value)}catch(t){r.value=m(t)}}async function p(){r.value="";try{e.value?.uid&&await xe(e.value.uid),await Le()}catch(t){r.value=m(t)}}function m(t){return(t?.message||String(t)).replace("Firebase: ","")}return(t,o)=>((0,n.uX)(),(0,n.CE)("header",Ne,[e.value?((0,n.uX)(),(0,n.CE)("div",Ee,[(0,n.Lk)("span",null,[o[2]||(o[2]=(0,n.eW)("เข้าสู่ระบบแล้ว: ",-1)),(0,n.Lk)("strong",null,(0,l.v_)(e.value.displayName||e.value.email||c.value),1)]),(0,n.Lk)("button",{onClick:p,style:{"margin-left":"0.5rem"}},"ออกจากระบบ")])):((0,n.uX)(),(0,n.CE)("div",ze,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>a.value=t),type:"email",placeholder:"อีเมล"},null,512),[[i.Jo,a.value]]),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":o[1]||(o[1]=t=>s.value=t),type:"password",placeholder:"รหัสผ่าน"},null,512),[[i.Jo,s.value]]),(0,n.Lk)("button",{onClick:u},"เข้าสู่ระบบ"),(0,n.Lk)("button",{onClick:h},"สมัคร"),(0,n.Lk)("button",{class:"google-btn",onClick:d},o[3]||(o[3]=[(0,n.Fv)('<svg class="google-icon" viewBox="0 0 24 24" data-v-1aa7ccf6><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" data-v-1aa7ccf6></path><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" data-v-1aa7ccf6></path><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" data-v-1aa7ccf6></path><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" data-v-1aa7ccf6></path></svg>',1)])),r.value?((0,n.uX)(),(0,n.CE)("span",Te,(0,l.v_)(r.value),1)):(0,n.Q3)("",!0)]))]))}},Be=a(1241);const We=(0,Be.A)(Ae,[["__scopeId","data-v-1aa7ccf6"]]);var _e=We,$e={name:"App",components:{LoginBar:_e},data(){return{raiModel:"",nganModel:"",wahModel:"",_isSyncingSize:!1,_isSyncingPrice:!1,_lastPriceSource:"perSqw",isFormOpen:!0,isListOpen:!0,editingLandId:null,snapPoints:[],mapMarkers:[],showMarkerInfo:!1,selectedMarker:null,markerInfoPosition:{x:0,y:0},map:null,selectedMapType:"hybrid",dolEnabled:!0,opacity:.5,activeTab:"dashboard",snapEnabled:!0,wmsDol:null,leafletWmsDol:null,snapSettings:{red:180,green:90,blue:90},landData:{size:"",width:"",owner:"",agent:"",phone:"",lineId:"",price:"",totalPrice:"",road:"",landFrame:"",deedInformation:""},savedLands:[],filteredLands:[],currentLocation:{lat:13.7563,lon:100.5234},currentZoom:12,showSearch:!1,showFilters:!1,showLayers:!1,searchQuery:"",filters:{landType:"",roadWidth:"",areaMinRai:"",areaMin:"",areaMax:"",areaMaxRai:"",priceMin:"",priceMax:"",totalPriceMin:"",totalPriceMax:"",frontMin:"",frontMax:""},availableLayers:[{id:1,name:"ดาวเทียม",visible:!0},{id:2,name:"แผนที่",visible:!1},{id:3,name:"จราจร",visible:!1}],showChat:!1,chatMode:"rooms",chatMessages:[],chatRooms:[],chatInput:"",currentUserId:null,userProfile:{name:"",joinedAt:null},tempUserName:"",hasNewMessage:!1,unreadCount:0,lastSeenMessageId:null,onlineUsers:[],selectedUser:null,currentChatRoom:null,showTypingIndicator:!1,typingTimer:null,chatUnsubscribe:null,authUnsubscribe:null,myMarker:null,locating:!1,geolocError:null,onlineStatusInterval:null,chatRoomsUnsubscribe:null,p2pChatUnsubscribe:null,onlineUsersUnsubscribe:null,drawMode:!1,drawPoints:[],drawPolyline:null,drawPolygon:null,landOverlays:[],landsUnsub:null,showDisclaimer:!0,kmlState:null,kmlOverlays:[],kmlFeatures:[],bkkRect:null,kmlOpacity:.6}},async mounted(){this.initMap(),this.authUnsubscribe=be(t=>{if(!t)return this.resetP2PState(),this.currentUserId=null,void(this.userProfile={name:"",joinedAt:null});const e=localStorage.getItem("ackDisclaimer");"yes"===e&&(this.showDisclaimer=!1);const a=this.currentUserId&&this.currentUserId!==t.uid;a&&this.resetP2PState(),this.currentUserId=t.uid,this.userProfile.name||(this.userProfile.name=t.displayName||(t.email?t.email.split("@")[0]:"")),this.updateUserOnlineStatus(),this.initP2PFacade(),this.landsUnsub=Oe(t=>{this.savedLands=Array.isArray(t)?t:[],this.renderLandsOnMap()})})},beforeUnmount(){this.onlineUsersUnsubscribe&&this.onlineUsersUnsubscribe(),this.p2pChatUnsubscribe&&this.p2pChatUnsubscribe(),this.chatRoomsUnsubscribe&&this.chatRoomsUnsubscribe(),this.onlineStatusInterval&&clearInterval(this.onlineStatusInterval),this.typingTimer&&clearTimeout(this.typingTimer),this.authUnsubscribe&&this.authUnsubscribe()},computed:{visibleMarkers(){const t=(this.searchQuery||"").trim().toLowerCase(),e=t=>""===t||null==t?null:Number(String(t).replace(/,/g,"")),a=t=>{if(!t)return null;const e=String(t).match(/([\d,.]+)/);return e?Number(e[1].replace(/,/g,"")):null},i=(t,a)=>{const i=e(t),n=e(a);return null==i&&null==n?null:(i||0)+400*(n||0)},n=i(this.filters.areaMin,this.filters.areaMinRai),l=i(this.filters.areaMax,this.filters.areaMaxRai),s=e(this.filters.priceMin),r=e(this.filters.priceMax),o=e(this.filters.allPriceMin),c=e(this.filters.allPriceMax),d=e(this.filters.frontMin),u=e(this.filters.frontMax),h=(this.filters.roadWidth||this.filters.landType||"").trim(),p=t=>{switch(t){case"lt6":return[null,6];case"6-9.99":return[6,9.99];case"10-11.99":return[10,11.99];case"12-17.99":return[12,17.99];case"18-29.99":return[18,29.99];case"ge30":return[30,null];default:return[null,null]}},[m,g]=p(h);return(this.markers||[]).filter(e=>{const i=!t||e.title?.toLowerCase().includes(t)||e.detail?.toLowerCase().includes(t),h=a(e.detail),p=(null==n||null!=h&&h>=n)&&(null==l||null!=h&&h<=l),y=null!=e.pricePerWah?Number(e.pricePerWah):null,f=(null==s||null!=y&&y>=s)&&(null==r||null!=y&&y<=r),b=null!=e.totalPrice?Number(e.totalPrice):null!=y&&null!=h?y*h:null,v=(null==o||null!=b&&b>=o)&&(null==c||null!=b&&b<=c),w=null!=e.frontage?Number(e.frontage):null,k=(null==d||null!=w&&w>=d)&&(null==u||null!=w&&w<=u),L=null!=e.road?Number(e.road):null,M=(null==m||null!=L&&L>=m)&&(null==g||null!=L&&L<=g);return i&&p&&f&&v&&k&&M})},dashboard(){const t=(this.filteredLands?.length?this.filteredLands:this.savedLands)||[],e=t.length,a=new Set(t.map(t=>t.ownerUid||(t.owner||"").trim()||(t.agent||"").trim()).filter(Boolean)).size,i=t.reduce((t,e)=>{const a=Number(e.size??e.area);return t+(Number.isFinite(a)?a:0)},0),n=i/400,l=t.reduce((t,e)=>{const a=Number(e.totalPrice);if(Number.isFinite(a)&&a>0)return t+a;const i=Number(e.pricePerSqw??e.price),n=Number(e.size??e.area);return t+(Number.isFinite(i)&&Number.isFinite(n)?i*n:0)},0);return{plots:e,owners:a,areaRai:n,totalValue:l,totalValueMillion:l/1e6}}},methods:{clearSelectedLand(){this.editingLandId=null,this.landData={size:"",width:"",road:"",price:"",totalPrice:"",landFrame:"",deedInformation:"",owner:"",agent:"",phone:"",lineId:"",raiModel:"",nganModel:"",wahModel:""},this.clearDrawing()},formatMoney(t){if(null==t||""===t)return"";const e=this.unformatDecimal(t);return null==e?"":e.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})},formatPrice(t){return this.formatMoney(t)},onPriceTyping(t){const e=t.target,a=this.sanitizeDecimal(e.value),i=this.unformatDecimal(a);null==i||isNaN(i)?this.landData.price="":(this.landData.price=i.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2}),this.syncPriceFromPerSqw(),this.$nextTick(()=>{try{const t=e.value.length;e.setSelectionRange(t,t)}catch(He){}}))},syncPriceFromPerSqw(){const t=parseFloat(this.unformatDecimal(this.landData.price))||0,e=parseFloat(this.unformatDecimal(this.landData.size))||0;if(e>0&&t>=0){const a=t*e;this.landData.totalPrice=a.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})}else this.landData.totalPrice=""},syncPerSqwFromTotal(){const t=parseFloat(this.unformatDecimal(this.landData.totalPrice))||0,e=parseFloat(this.unformatDecimal(this.landData.size))||0;if(e>0&&t>=0){const a=t/e;this.landData.price=a.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})}else this.landData.price=""},sizeFromRaiNganWah(t,e,a){const i=parseInt(String(t??"").replace(/,/g,""),10),n=parseInt(String(e??"").replace(/,/g,""),10),l=parseFloat(String(a??"").replace(/,/g,""))||0,s=Number.isFinite(i)?i:0,r=Number.isFinite(n)?n:0,o=Number.isFinite(l)?l:0;return+(400*s+100*r+o).toFixed(2)},rnwFromSize(t){const e=parseFloat(String(t??"").replace(/,/g,""));if(!Number.isFinite(e)||e<0)return{rai:"",ngan:"",wah:""};const a=Math.floor(e/400),i=e-400*a,n=Math.floor(i/100),l=+(i-100*n).toFixed(2);return{rai:a,ngan:n,wah:l}},syncFromSize(){if(!this._isSyncingSize){this._isSyncingSize=!0;try{const{rai:t,ngan:e,wah:a}=this.rnwFromSize(this.landData.size);this.raiModel=""===t?"":String(t),this.nganModel=""===e?"":String(e),this.wahModel=""===a?"":this.fmt2?this.fmt2(a):a.toFixed(2)}finally{this._isSyncingSize=!1}}},onRNWInput(){if(!this._isSyncingSize){this._isSyncingSize=!0;try{const t=this.sizeFromRaiNganWah(this.raiModel,this.nganModel,this.wahModel);this.landData.size=Number.isInteger(t)?t.toLocaleString():t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}finally{this._isSyncingSize=!1}}},normalizeRNW(){let t=parseInt(this.raiModel||0,10);t=Number.isFinite(t)?t:0;let e=parseInt(this.nganModel||0,10);e=Number.isFinite(e)?e:0;let a=parseFloat(this.wahModel||0);a=Number.isFinite(a)?a:0,a>=100&&(e+=Math.floor(a/100),a%=100),e>=4&&(t+=Math.floor(e/4),e%=4),a<0&&(a=0),e<0&&(e=0),t<0&&(t=0),this.raiModel=String(t),this.nganModel=String(e),this.wahModel=this.fmt2?this.fmt2(a):a.toFixed(2),this.onRNWInput()},makeGroundKmlString({west:t=100.2,south:e=13.4,east:a=101.05,north:i=14.1,opacity:n=.7}={}){const l=Math.round(255*n).toString(16).padStart(2,"0"),s=`${l}ffffff`;return`<?xml version="1.0" encoding="UTF-8"?>\n      <kml xmlns="http://www.opengis.net/kml/2.2">\n        <Document>\n          <GroundOverlay>\n            <Icon><href>/img/bangkok_56.png</href></Icon>\n            <LatLonBox>\n              <north>${i}</north>\n              <south>${e}</south>\n              <east>${a}</east>\n              <west>${t}</west>\n            </LatLonBox>\n            <color>${s}</color>\n          </GroundOverlay>\n        </Document>\n      </kml>`},addBangkokOverlayDaft(){if(!this.map)return;if(this.bkkRect){try{this.map.Overlays.remove(this.bkkRect)}catch(s){}this.bkkRect=null}const t=100.325,e=13.9548,a=100.9412,i=13.484,n={lon:t,lat:e},l={lon:a,lat:i};this.bkkRect=new window.longdo.Rectangle(n,l,{texture:"/img/bangkok_draft.png",textureAlpha:this.kmlOpacity,lineWidth:0,weight:window.longdo.OverlayWeight.Top}),this.map.Overlays.add(this.bkkRect)},addBangkokOverlay(){if(!this.map)return;if(this.bkkRect){try{this.map.Overlays.remove(this.bkkRect)}catch(s){}this.bkkRect=null}const t=100.327,e=13.956,a=100.9402,i=13.4843,n={lon:t,lat:e},l={lon:a,lat:i};this.bkkRect=new window.longdo.Rectangle(n,l,{texture:"/img/bangkok_56.png",textureAlpha:this.kmlOpacity,lineWidth:0,weight:window.longdo.OverlayWeight.Top}),this.map.Overlays.add(this.bkkRect)},setBangkokOverlayOpacity(t){this.kmlOpacity=+t,this.addBangkokOverlay()},clearBangkokOverlay(){this.map&&this.bkkRect&&(this.map.Overlays.remove(this.bkkRect),this.bkkRect=null)},loadBangkokOverlay(){if(!this.map)return;this.clearKml();const t=this.makeGroundKmlString({opacity:this.kmlOpacity}),e=window.kmlToLongdoMap(this.map,t,{});this.kmlState=e,this.kmlOverlays=e&&e.overlays||[],e?.bound&&this.map.bound(e.bound)},acceptDisclaimer(){this.showDisclaimer=!1,localStorage.setItem("ackDisclaimer","yes")},closeDisclaimerOnce(){this.showDisclaimer=!1},resetP2PState(){this.onlineUsersUnsubscribe&&(this.onlineUsersUnsubscribe(),this.onlineUsersUnsubscribe=null),this.p2pChatUnsubscribe&&(this.p2pChatUnsubscribe(),this.p2pChatUnsubscribe=null),this.chatRoomsUnsubscribe&&(this.chatRoomsUnsubscribe(),this.chatRoomsUnsubscribe=null),this.onlineStatusInterval&&(clearInterval(this.onlineStatusInterval),this.onlineStatusInterval=null),this.onlineUsers=[],this.chatRooms=[],this.selectedUser=null,this.currentChatRoom=null,this.chatMessages=[],this.showTypingIndicator=!1,this.hasNewMessage=!1,this.unreadCount=0,this.lastSeenMessageId=null},initDolWms_Longdo(){try{this.map?.Event?.bind?.("ready",()=>{const t=new window.longdo.Layer("dol",{type:window.longdo.LayerType.WMS,url:"https://ms.longdo.com/mapproxy/service",format:"image/png",srs:"EPSG:3857",opacity:this.opacity??.85});console.log("[DOL WMS] constructed is longdo.Layer?",t instanceof window.longdo.Layer,t),this.wmsDol=t,this.dolEnabled&&this.map.Layers.add(this.wmsDol)})}catch(t){console.debug("initDolWms_Longdo error:",t)}},onChangeBaseMap(t){if(!this.map||!window.longdo?.Layers)return;const e=(t||"").toUpperCase(),a=t=>"function"===typeof t?t():t,i=window.longdo.Layers,n={NORMAL:i.NORMAL,HYBRID:i.HYBRID,SATELLITE:i.SATELLITE,GRAY:i.GRAY},l=a(n[e]||i.HYBRID);console.log("setBase =>",e,"type=",typeof n[e],"target=",l);try{this.map.Layers?.setBase?this.map.Layers.setBase(l):this.map.Layers?.base&&this.map.Layers.base(l)}catch(s){console.error("setBase error:",s,"key=",e,"target=",l)}},applyDolVisibility(){try{if(!this.map?.Layers?.add||!this.wmsDol)return;this.wmsDol.opacity=this.opacity??.85,this.dolEnabled?(this.map.Layers.remove(this.wmsDol),this.map.Layers.add(this.wmsDol)):this.map.Layers.remove(this.wmsDol)}catch(t){console.debug("applyDolVisibility error:",t)}},onToggleDol(){this.applyDolVisibility()},onChangeDolOpacity(){this.applyDolVisibility()},async deleteLandItem(t){if(t&&this.currentUserId&&confirm("ยืนยันลบแปลงนี้?"))try{await Fe(this.currentUserId,t)}catch(e){console.error("deleteLand failed:",e),alert("ลบไม่สำเร็จ")}},renderLandsOnMap(){if(!this.map)return;try{this.landOverlays.forEach(t=>this.map.Overlays.remove(t))}catch(e){console.debug("renderLandsOnMap: remove overlays failed:",e)}this.landOverlays=[];const t=(this.filteredLands&&this.filteredLands.length?this.filteredLands:this.savedLands)||[];t.forEach(t=>{let a=null;try{if("Polygon"===t.geometry?.type&&Array.isArray(t.geometry.coordinates)){const e=t.geometry.coordinates.map(([t,e])=>({lon:t,lat:e}));if(e.length>=3){let t=0,i=0,n=0;for(let a=0;a<e.length;a++){const l=e[a],s=e[(a+1)%e.length],r=l.lon*s.lat-s.lon*l.lat;t+=r,i+=(l.lon+s.lon)*r,n+=(l.lat+s.lat)*r}t*=.5,a=t?{lon:i/(6*t),lat:n/(6*t)}:e[0]}}}catch(e){}if(!a&&t.location&&"number"===typeof t.location.lon&&"number"===typeof t.location.lat&&(a=t.location),a){const e=new window.longdo.Marker(a,{title:t.owner||t.agent+"(นายหน้า)"||0,detail:[null!=t.size?`ขนาดที่ดิน: ${this.fmt2(t.size)} ตร.วา`:"",null!=t.frontage?`หน้ากว้างติดถนน: ${this.fmt2(t.frontage)} ม.`:"",null!=t.roadWidth?`ขนาดถนน: ${this.fmt2(t.roadWidth)} ม.`:"",null!=t.pricePerSqw?`ราคา/ตร.วา: ${this.fmt2(t.pricePerSqw)} บ.`:"",null!=t.totalPrice?`ราคารวม: ${this.fmt2(t.totalPrice)} บ.`:""].filter(Boolean).join(" <br> "),visibleRange:{min:7,max:20},icon:{url:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24'><path d='M12 2C7.58 2 4 5.58 4 10c0 5.25 5.4 10.58 7.2 12.19a1.2 1.2 0 0 0 1.6 0C14.6 20.58 20 15.25 20 10c0-4.42-3.58-8-8-8z' fill='rgba(255,255,255,0.85)' stroke='%239ca3af' stroke-width='1'/><circle cx='12' cy='10' r='3' fill='%239ca3af'/></svg>",size:{width:28,height:28},offset:{x:14,y:28}}});e.__land=t,this.map.Overlays.add(e),this.landOverlays.push(e)}if("Polygon"===t.geometry?.type&&Array.isArray(t.geometry.coordinates)){const e=t.geometry.coordinates.map(([t,e])=>({lon:t,lat:e}));if(e.length>=3){const a=new window.longdo.Polygon(e,{lineWidth:2,lineColor:"rgba(255,215,0,0.9)",fillColor:"rgba(255,215,0,0.25)"});a.__land=t,this.map.Overlays.add(a),this.landOverlays.push(a)}}})},initMap(){"undefined"!==typeof window.longdo?(this.map=new window.longdo.Map({placeholder:document.getElementById("map"),language:"th",layer:"function"===typeof window.longdo.Layers.HYBRID?window.longdo.Layers.HYBRID():window.longdo.Layers.HYBRID}),this.map.location({lon:this.currentLocation.lon,lat:this.currentLocation.lat,includePolygon:!1},!0),this.map.zoom(this.currentZoom,!0),this.selectedMapType="hybrid",this.initDolWms_Longdo(),this.applyDolVisibility(),this.map.Event.bind("ready",()=>{console.log("Map is ready, adding markers..."),this.addMarkersToMap()}),this.map.Event.bind("click",t=>{if(this.showMarkerInfo=!1,!this.drawMode)return void this.clearSelectedLand();const e=this.getClickLocation(t);if(e){this.drawPoints.push({lon:e.lon,lat:e.lat}),this.redrawDrawing();try{const t=new window.longdo.Circle(e,1,{fillColor:"rgba(0,0,0,0.7)"});this.map.Overlays.add(t),setTimeout(()=>this.map.Overlays.remove(t),500)}catch(a){}}})):setTimeout(()=>this.initMap(),500)},focusLand(t,e=17){if(!t||!this.map)return;this.selectLand(t);const a=this.getLandCenter(t);this.centerTo(a.lon,a.lat,e)},getLandCenter(t){if("Polygon"===t?.geometry?.type&&Array.isArray(t.geometry.coordinates)){const e=t.geometry.coordinates.map(([t,e])=>({lon:t,lat:e}));if(e.length>=3){let t=0,a=0,i=0;for(let n=0;n<e.length;n++){const l=e[n],s=e[(n+1)%e.length],r=l.lon*s.lat-s.lon*l.lat;t+=r,a+=(l.lon+s.lon)*r,i+=(l.lat+s.lat)*r}return t*=.5,t?{lon:a/(6*t),lat:i/(6*t)}:e[0]}}return null!=t?.location?.lon&&null!=t?.location?.lat?{lon:t.location.lon,lat:t.location.lat}:{lon:this.currentLocation.lon,lat:this.currentLocation.lat}},addMarkersToMap(){if(!this.map)return;this.clearAllMarkers();const t=this.availableLayers.find(t=>1===t.id);t&&t.visible&&(this.visibleMarkers.forEach(t=>{const e=new window.longdo.Marker(t.location,{title:t.title,detail:t.detail,icon:t.icon||{url:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24'><path d='M12 2C7.58 2 4 5.58 4 10c0 5.25 5.4 10.58 7.2 12.19a1.2 1.2 0 0 0 1.6 0C14.6 20.58 20 15.25 20 10c0-4.42-3.58-8-8-8z' fill='rgba(255,255,255,0.85)' stroke='%239ca3af' stroke-width='1'/><circle cx='12' cy='10' r='3' fill='%239ca3af'/></svg>",size:{width:32,height:32},offset:{x:16,y:32}},visibleRange:{min:7,max:20},draggable:!1,weight:window.longdo.OverlayWeight?window.longdo.OverlayWeight.Top:null,popup:{html:`<div style="padding: 10px;">\n                                <h4 style="margin: 0 0 5px 0; color: #333;">${t.title}</h4>\n                                <p style="margin: 0; color: #666; font-size: 14px;">${t.detail}</p>\n                            </div>`}});this.mapMarkers.push({data:t,marker:e}),this.map.Overlays.add(e)}),this.map.Event&&this.map.Event.bind&&this.map.Event.bind("overlayClick",t=>{if(t&&t.__land)return void this.onLandOverlayClick(t.__land,t);const e=this.mapMarkers.find(e=>e.marker===t);e&&this.onMarkerClick(e.data,t)}))},onMarkerClick(t){this.selectedMarker=t,this.showMarkerInfo=!0,t.location&&this.map.location(t.location,!0),console.log("Marker clicked:",t)},clearAllMarkers(){this.map&&(this.mapMarkers.forEach(t=>{this.map.Overlays.remove(t.marker)}),this.mapMarkers=[])},toggleMarkersLayer(){const t=this.availableLayers.find(t=>1===t.id);t&&(t.visible?this.addMarkersToMap():this.clearAllMarkers())},addNewMarker(t){const e={id:this.markers.length+1,location:t,title:`พื้นที่ใหม่ ${this.markers.length+1}`,detail:"คลิกเพื่อแก้ไขรายละเอียด",icon:{url:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24'><path d='M12 2C7.58 2 4 5.58 4 10c0 5.25 5.4 10.58 7.2 12.19a1.2 1.2 0 0 0 1.6 0C14.6 20.58 20 15.25 20 10c0-4.42-3.58-8-8-8z' fill='rgba(255,255,255,0.85)' stroke='%239ca3af' stroke-width='1'/><circle cx='12' cy='10' r='3' fill='%239ca3af'/></svg>",size:{width:32,height:32},offset:{x:16,y:32}}};this.markers.push(e),this.addMarkersToMap()},centerOnMarker(t){this.map&&t.location&&(this.map.location(t.location,!0),this.map.zoom(15,!0))},async setUserProfile(){this.tempUserName.trim()&&(this.userProfile.name=this.tempUserName.trim(),this.userProfile.joinedAt=Date.now(),await this.updateUserOnlineStatus(),this.currentUserId&&this.initP2PFacade())},async sendMessage(){if(this.chatInput.trim()&&this.userProfile.name&&this.selectedUser)try{await Se(this.chatInput.trim(),this.currentUserId,this.userProfile.name,this.selectedUser.uid),this.chatInput=""}catch(t){console.error("send P2P failed:",t),alert("ไม่สามารถส่งข้อความได้ กรุณาลองใหม่อีกครั้ง")}},handleTyping(){this.typingTimer&&clearTimeout(this.typingTimer),this.showTypingIndicator=!0,this.typingTimer=setTimeout(()=>{this.showTypingIndicator=!1},1e3)},formatNumber(t){return null==t||""===t?"":t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},fmt2(t){if(null==t||""===t)return"";const e="string"===typeof t?parseFloat(t.replace(/,/g,"")):Number(t);return Number.isFinite(e)?e.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2}):""},fmt(t){if(null==t||""===t)return"";const e="string"===typeof t?parseFloat(t.replace(/,/g,"")):Number(t);return Number.isFinite(e)?e.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0}):""},unformatNumber(t){return t?parseInt(t.replace(/,/g,""),10):""},sanitizeDecimal(t){if(null==t)return"";let e=String(t).replace(/,/g,"").replace(/[^\d.]/g,"");const a=e.indexOf(".");return-1!==a&&(e=e.slice(0,a+1)+e.slice(a+1).replace(/\./g,"")),e},unformatDecimal(t){if(null==t||""===t)return null;const e=parseFloat(String(t).replace(/,/g,""));return Number.isFinite(e)?e:null},formatLandSize(t){if(null==t||""===t)return"";let e=String(t).replace(/,/g,"").trim();if(e.startsWith(".")&&(e="0"+e),"."===e||"0."===e)return"";const a=parseFloat(e);return Number.isFinite(a)?e.endsWith(".")||/\.0+$/.test(e)?a.toLocaleString():/^\d+\.\d$/.test(e)||/^0\.\d$/.test(e)?a.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):Number.isInteger(a)?a.toLocaleString():a.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):""},formatTime(t){if(!t)return"";const e=new Date(t),a=new Date,i=Math.floor((a-e)/6e4);return i<1?"ตอนนี้":i<60?`${i} นาทีที่แล้ว`:i<1440?`${Math.floor(i/60)} ชั่วโมงที่แล้ว`:e.toLocaleDateString("th-TH",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},scrollToBottom(){this.$refs.chatBody&&(this.$refs.chatBody.scrollTop=this.$refs.chatBody.scrollHeight)},toggleP2P(){this.showChat=!this.showChat,this.showChat&&(this.hasNewMessage=!1,this.setChatMode("rooms"),this.$nextTick(()=>this.scrollToBottom()))},initP2PFacade(){this.currentUserId&&(this.onlineUsersUnsubscribe&&this.onlineUsersUnsubscribe(),this.onlineUsersUnsubscribe=Pe(t=>{this.onlineUsers=t.filter(t=>t.uid!==this.currentUserId)}),this.chatRoomsUnsubscribe&&this.chatRoomsUnsubscribe(),this.chatRoomsUnsubscribe=Ue(this.currentUserId,t=>{this.chatRooms=t,this.unreadCount=t.reduce((t,e)=>t+(e.unreadCount||0),0),this.hasNewMessage=this.unreadCount>0}),this.updateUserOnlineStatus(),this.onlineStatusInterval&&clearInterval(this.onlineStatusInterval),this.onlineStatusInterval=setInterval(()=>this.updateUserOnlineStatus(),3e4))},async updateUserOnlineStatus(){if(this.currentUserId&&this.userProfile.name)try{await Me(this.currentUserId,{name:this.userProfile.name,lastSeen:Date.now()})}catch(t){console.error("Failed to update online status:",t)}},setChatMode(t){this.chatMode=t,"rooms"===t&&this.p2pChatUnsubscribe&&(this.p2pChatUnsubscribe(),this.p2pChatUnsubscribe=null)},backToRooms(){this.setChatMode("rooms")},selectUserToChat(t){this.selectedUser=t,this.chatMode="chat",this.startRoomWith(t.uid)},selectChatRoom(t){const e=this.onlineUsers.find(e=>e.uid===t.otherUid);e?this.selectUserToChat(e):(this.selectedUser={uid:t.otherUid,name:`User-${t.otherUid.slice(0,6)}`},this.chatMode="chat",this.startRoomWith(t.otherUid))},startRoomWith(t){this.p2pChatUnsubscribe&&this.p2pChatUnsubscribe(),this.p2pChatUnsubscribe=De(this.currentUserId,t,e=>{this.chatMessages=e,this.$nextTick(()=>this.scrollToBottom()),Ce(this.currentUserId,t)}),this.currentChatRoom=t},centerBangkok(){this.map&&(this.map.location({lon:100.5234,lat:13.7563,includePolygon:!1},!0),this.currentLocation={lat:13.7563,lon:100.5234},this.map.zoom(12,!0))},reloadAPI(){console.log("Reloading API..."),this.initMap()},async loadKmlFromUrl(t){if(this.map)if(t)try{const e=await fetch(t,{cache:"no-store"}),a=await e.text();this.clearKml();const i=window.kmlToLongdoMap(this.map,a,{geometryOptions:{lineWidth:2,lineColor:"rgba(255,215,0,0.95)",fillColor:"rgba(255,215,0,0.25)"},markerOptions:{icon:{url:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24'><path d='M12 2C7.58 2 4 5.58 4 10c0 5.25 5.4 10.58 7.2 12.19a1.2 1.2 0 0 0 1.6 0C14.6 20.58 20 15.25 20 10c0-4.42-3.58-8-8-8z' fill='rgba(255,255,255,0.85)' stroke='%239ca3af' stroke-width='1'/><circle cx='12' cy='10' r='3' fill='%239ca3af'/></svg>",size:{width:28,height:28},offset:{x:14,y:28}},visibleRange:{min:6,max:20}}});this.kmlState=i,this.kmlOverlays=i&&Array.isArray(i.overlays)?i.overlays:[],this.kmlFeatures=Array.isArray(i?.features)?i.features:[],i?.bound&&this.map.bound(i.bound),this.applyKmlFiltersUsingUI(),this.updateSnapPoints()}catch(e){console.error("loadKmlFromUrl error:",e),alert("โหลด KML ไม่สำเร็จ: "+(e?.message||e))}else alert("กรุณาระบุ URL ของไฟล์ KML")},clearKml(){if(this.map){try{this.kmlState?.overlays?.length?this.kmlState.overlays.forEach(t=>this.map.Overlays.remove(t)):this.kmlOverlays?.length&&this.kmlOverlays.forEach(t=>this.map.Overlays.remove(t))}catch(t){console.debug("clearKml remove overlays failed:",t)}this.kmlState=null,this.kmlOverlays=[]}},async importKmlFile(t){const e=t?.target?.files?.[0];if(e)try{const t=await e.text();this.clearKml();const a=window.kmlToLongdoMap(this.map,t,{geometryOptions:{lineWidth:2,lineColor:"rgba(0,0,0,0.9)",fillColor:"rgba(30,144,255,0.25)"},markerOptions:{icon:{url:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24'><path d='M12 2C7.58 2 4 5.58 4 10c0 5.25 5.4 10.58 7.2 12.19a1.2 1.2 0 0 0 1.6 0C14.6 20.58 20 15.25 20 10c0-4.42-3.58-8-8-8z' fill='rgba(255,255,255,0.85)' stroke='%239ca3af' stroke-width='1'/><circle cx='12' cy='10' r='3' fill='%239ca3af'/></svg>",size:{width:28,height:28},offset:{x:14,y:28}},visibleRange:{min:6,max:20}}});this.kmlState=a,this.kmlOverlays=a&&Array.isArray(a.overlays)?a.overlays:[],this.kmlFeatures=Array.isArray(a?.features)?a.features:[],a?.bound&&this.map.bound(a.bound),this.applyKmlFiltersUsingUI(),this.updateSnapPoints()}catch(a){console.error("importKmlFile error:",a),alert("อ่านไฟล์ KML ไม่สำเร็จ: "+(a?.message||a))}finally{try{t.target.value=""}catch(He){}}},redrawDrawing(){if(this.map){try{this.drawPolyline&&this.map.Overlays.remove(this.drawPolyline)}catch(t){console.debug("redraw: rm polyline fail",t)}try{this.drawPolygon&&this.map.Overlays.remove(this.drawPolygon)}catch(t){console.debug("redraw: rm polygon fail",t)}this.drawPoints.length>=2&&(this.drawPolyline=new window.longdo.Polyline(this.drawPoints,{lineWidth:3,lineColor:"rgba(0,0,0,0.6)"}),this.map.Overlays.add(this.drawPolyline))}},startDrawing(){this.drawMode=!0,this.drawPoints=[],this.redrawDrawing(),this.updateSnapPoints();try{document.getElementById("map").style.cursor="crosshair"}catch(t){}},finishDrawing(){if(this.map)if(this.drawPoints.length<3)alert("ต้องคลิกอย่างน้อย 3 จุด");else{try{this.drawPolyline&&this.map.Overlays.remove(this.drawPolyline)}catch(t){}try{this.drawPolygon&&this.map.Overlays.remove(this.drawPolygon)}catch(t){}this.drawPolygon=new window.longdo.Polygon(this.drawPoints,{lineWidth:2,lineColor:"rgba(30,144,255,0.9)",fillColor:"rgba(30,144,255,0.25)"}),this.map.Overlays.add(this.drawPolygon),this.drawMode=!1,this.updateSnapPoints();try{document.getElementById("map").style.cursor="default"}catch(t){}}},clearDrawing(){this.drawMode=!1,this.drawPoints=[];try{this.drawPolyline&&this.map.Overlays.remove(this.drawPolyline)}catch(t){}try{this.drawPolygon&&this.map.Overlays.remove(this.drawPolygon)}catch(t){}this.drawPolyline=null,this.drawPolygon=null,this.updateSnapPoints();try{document.getElementById("map").style.cursor="default"}catch(t){}},applyFilters(){console.log(this.filters),this.showFilters=!1;const{roadWidth:t,areaMin:e,areaMax:a,areaMinRai:i,areaMaxRai:n,priceMin:l,totalPriceMin:s,totalPriceMax:r,priceMax:o,frontMin:c,frontMax:d}=this.filters,u=t=>""===t||null==t?null:Number(String(t).replace(/,/g,"")),h=t=>t?"lt6"===t?[null,6]:"6-9.99"===t?[6,9.99]:"ge10"===t?[10,null]:"ge18"===t?[18,null]:"ge30"===t?[30,null]:[null,null]:[null,null],p=(t,e)=>{const a=u(t),i=u(e);return null==a&&null==i?null:(a||0)+400*(i||0)},[m,g]=h(t),y=p(e,i),f=p(a,n),b=u(l),v=u(o),w=u(s),k=u(r),L=u(c),M=u(d),x=t=>null!=t.area?+t.area:t.size?+t.size:0,P=t=>null!=t.pricePerSqw?+t.pricePerSqw:t.price?+t.price:0,S=t=>t.totalPrice??x(t)*P(t),D=t=>null!=t.frontage?+t.frontage:t.width?+t.width:0,C=t=>null!=t.roadWidth?+t.roadWidth:t.road?+t.road:null;Array.isArray(this.savedLands)?this.filteredLands=this.savedLands.filter(t=>{const e=x(t),a=P(t),i=+S(t),n=D(t),l=C(t),s=(null==y||e>=y)&&(null==f||e<=f),r=(null==b||a>=b)&&(null==v||a<=v),o=(null==w||i>=w)&&(null==k||i<=k),c=(null==L||n>=L)&&(null==M||n<=M),d=(null==m||null!=l&&l>=m)&&(null==g||null!=l&&l<=g);return s&&r&&o&&c&&d}):this.filteredLands=[],this.addMarkersToMap(),this.renderLandsOnMap(),this.applyKmlFiltersUsingUI()},applyKmlFiltersUsingUI(){if(!this.map||!Array.isArray(this.kmlFeatures)||!this.kmlFeatures.length)return;const t=t=>""===t||null==t?null:Number(String(t).replace(/,/g,"")),e=(e,a)=>{const i=t(e),n=t(a);return null==i&&null==n?null:(i||0)+400*(n||0)},a=e(this.filters.areaMin,this.filters.areaMinRai),i=e(this.filters.areaMax,this.filters.areaMaxRai),n=t(this.filters.priceMin),l=t(this.filters.priceMax),s=t(this.filters.totalPriceMin),r=t(this.filters.totalPriceMax),o=t(this.filters.frontMin),c=t(this.filters.frontMax),d=(this.filters.roadWidth||this.filters.landType||"").trim(),u=t=>{switch(t){case"lt6":return[null,6];case"6-9.99":return[6,9.99];case"10-11.99":return[10,11.99];case"12-17.99":return[12,17.99];case"18-29.99":return[18,29.99];case"ge30":return[30,null];default:return[null,null]}},[h,p]=u(d),m=(t,e,a)=>(null==e||null!=t&&t>=e)&&(null==a||null!=t&&t<=a);this.kmlFeatures.forEach(({overlay:t,props:e})=>{const d=null!=e?.totalPrice?Number(e.totalPrice):null!=e?.area&&null!=e?.pricePerSqw?Number(e.area)*Number(e.pricePerSqw):null,u=m(e?.area,a,i)&&m(e?.pricePerSqw,n,l)&&m(d,s,r)&&m(e?.frontage,o,c)&&m(e?.roadWidth,h,p);try{u?t._onMap||(this.map.Overlays.add(t),t._onMap=!0):(console.log("Removing",t.__kml?.props?.name,t),this.map.Overlays.remove(t),t._onMap=!1)}catch(g){}})},resetFilters(){this.filters={landType:"",priceMin:"",priceMax:"",areaMin:"",areaMax:"",totalPriceMin:"",totalPriceMax:"",roadWidth:"",frontMin:"",frontMax:""},this.filteredLands=[],this.addMarkersToMap(),this.renderLandsOnMap()},getClickLocation(t){if(t&&"number"===typeof t.lon&&"number"===typeof t.lat)return{lon:t.lon,lat:t.lat};if(t&&"number"===typeof t.x&&"number"===typeof t.y&&this.map?.location)try{const e=this.map.location(t);if(e&&"number"===typeof e.lon&&"number"===typeof e.lat)return e}catch(e){console.debug("getClickLocation: map.location(point) failed",e)}try{const t=this.map.location(window.longdo?.LocationMode?.Pointer);if(t&&"number"===typeof t.lon&&"number"===typeof t.lat)return t}catch(e){console.debug("getClickLocation: Pointer mode failed",e)}return null},async saveLandData(){if(!this.landData.owner?.trim()&&!this.landData.agent?.trim())return void alert("กรุณากรอกชื่อเจ้าของ หรือ ชื่อนายหน้า อย่างใดอย่างหนึ่ง");const t=null!=this.raiModel&&""!==String(this.raiModel).trim()||null!=this.nganModel&&""!==String(this.nganModel).trim()||null!=this.wahModel&&""!==String(this.wahModel).trim();let e=this.unformatDecimal(this.landData.size);t&&(e=this.sizeFromRaiNganWah(this.raiModel,this.nganModel,this.wahModel));const a=this.drawPoints.length>=3?{type:"Polygon",coordinates:this.drawPoints.map(t=>[t.lon,t.lat])}:null,i=a?{lon:this.drawPoints[0].lon,lat:this.drawPoints[0].lat}:{lon:this.currentLocation.lon,lat:this.currentLocation.lat},n={size:e,frontage:this.unformatDecimal(this.landData.width),roadWidth:this.unformatDecimal(this.landData.road),pricePerSqw:this.unformatDecimal(this.landData.price),totalPrice:this.unformatDecimal(this.landData.totalPrice),landFrame:(this.landData.landFrame||"").trim(),deedInformation:(this.landData.deedInformation||"").trim(),owner:(this.landData.owner||"").trim(),agent:(this.landData.agent||"").trim(),phone:(this.landData.phone||"").trim(),lineId:(this.landData.lineId||"").trim(),location:i,geometry:a,id:this.editingLandId||void 0};try{if(!this.currentUserId)return void alert("ยังไม่ได้เข้าสู่ระบบ (เปิด anonymous ได้)");await Ie(this.currentUserId,n),this.landData={size:"",width:"",owner:"",agent:"",phone:"",lineId:"",price:"",totalPrice:"",road:"",landFrame:"",deedInformation:""},this.editingLandId=null,this.clearDrawing(),alert("บันทึกเรียบร้อย")}catch(l){console.error("saveLand failed:",l),alert("บันทึกไม่สำเร็จ: "+(l?.message||l))}},toggleSearch(){this.showSearch=!this.showSearch,this.showFilters=!1,this.showLayers=!1,this.showChat=!1},toggleFilters(){this.showFilters=!this.showFilters,this.showSearch=!1,this.showLayers=!1,this.showChat=!1},toggleLayers(){this.showLayers=!this.showLayers,this.showSearch=!1,this.showFilters=!1,this.showChat=!1},viewMyProperty(){console.log("View my property"),this.showSearch=!1,this.showFilters=!1,this.showLayers=!0},exploreArea(){console.log("Explore area")},centerTo(t,e,a=17){if(this.map)try{this.map.location({lon:t,lat:e,includePolygon:!1}),"function"===typeof this.map.zoom&&this.map.zoom(a)}catch(i){console.debug("[SEARCH] centerTo error:",i)}},locateByGPS(){"geolocation"in navigator?(this.locating=!0,this.geolocError=null,navigator.geolocation.getCurrentPosition(t=>{const{latitude:e,longitude:a}=t.coords;this.currentLocation={lat:e,lon:a},this.centerTo(a,e,18),this.showSearch=!1,this.locating=!1},t=>{this.locating=!1,this.geolocError=t?.message||"ขอสิทธิ์ตำแหน่งไม่สำเร็จ",alert("ไม่สามารถระบุตำแหน่งได้: "+this.geolocError)},{enableHighAccuracy:!0,maximumAge:2e4,timeout:1e4})):alert("เบราเซอร์นี้ไม่รองรับการระบุตำแหน่ง (Geolocation)")},async ensureLongdoServices(){if(window.longdo?.Services?.search)return!0;for(let a=0;a<15;a++){if(window.longdo?.Services?.search)return!0;await new Promise(t=>setTimeout(t,200))}const t=["https://api.longdo.com/services","https://api.longdo.com/services/"];for(const a of t)try{if(await new Promise((t,e)=>{const i=document.createElement("script");i.src=a,i.async=!0,i.onload=t,i.onerror=()=>e(new Error("services load failed: "+a)),document.head.appendChild(i)}),window.longdo?.Services?.search)return!0}catch(e){console.debug("[SEARCH] inject services failed:",a,e)}return!!window.longdo?.Services?.search},async searchPlaceLongdo(t){if(await this.ensureLongdoServices())return new Promise(e=>{try{window.longdo.Services.search({keyword:t,limit:5,language:"th"},a=>{if(Array.isArray(a)&&a.length>0){const t=a[0];if(null!=t?.lon&&null!=t?.lat)return this.centerTo(t.lon,t.lat,17),this.showSearch=!1,void e(!0)}alert("ไม่พบผลลัพธ์จาก Longdo สำหรับ: "+t),e(!1)},t=>{console.debug("[SEARCH] Services.search error:",t),e(!1)})}catch(a){console.debug("[SEARCH] Services.search exception:",a)}});try{const e=window.__LONGDO_KEY,a=`https://search.longdo.com/mapsearch/json/search?keyword=${encodeURIComponent(t)}&key=${encodeURIComponent(e)}&limit=5&language=th`,i=await fetch(a),n=await i.text(),l=JSON.parse(n),s=Array.isArray(l?.data)?l.data:[];return s.length&&null!=s[0]?.lon&&null!=s[0]?.lat?(this.centerTo(s[0].lon,s[0].lat,17),this.showSearch=!1,!0):(alert("ไม่พบผลลัพธ์จาก Longdo สำหรับ: "+t),!1)}catch(e){return console.debug("[SEARCH] REST search error:",e),alert("ค้นหาไม่สำเร็จ (REST)"),!1}},performSearch(){const t=(this.searchQuery||"").trim();if(!t)return void this.locateByGPS();const e=t.match(/^\s*([+-]?\d+(?:\.\d+)?)\s*,\s*([+-]?\d+(?:\.\d+)?)\s*$/);if(e){const t=parseFloat(e[1]),a=parseFloat(e[2]);if(isFinite(t)&&isFinite(a)&&Math.abs(t)<=90&&Math.abs(a)<=180)return this.centerTo(a,t,18),void(this.showSearch=!1)}this.searchPlaceLongdo(t)},updateSnapPoints(){const t=[];(this.savedLands||[]).forEach(e=>{"Polygon"===e?.geometry?.type&&Array.isArray(e.geometry.coordinates)&&e.geometry.coordinates.forEach(([e,a])=>t.push({lon:e,lat:a}))}),Array.isArray(this.drawPoints)&&t.push(...this.drawPoints),this.snapPoints=t},getSnappedPoint(t){if(!this.snapEnabled||!Array.isArray(this.snapPoints)||!this.snapPoints.length)return t;const e="function"===typeof this.map?.zoom?this.map.zoom():16,a=e>=18?8:e>=16?15:30,i=window.longdo?.Util?.distance;if(!i)return t;let n=null,l=1/0;for(const s of this.snapPoints){const e=i([t,s]);e<l&&(l=e,n=s)}return n&&l<=a?n:t},selectLand(t){if(!t)return;this.editingLandId=t.id||null;const{rai:e,ngan:a,wah:i}=this.rnwFromSize(this.landData.size);this.raiModel=""===e?"":String(e),this.nganModel=""===a?"":String(a),this.wahModel=""===i?"":this.fmt2?this.fmt2(i):i.toFixed(2),this.landData={size:t.size??t.area??"",width:t.frontage??t.width??"",road:t.roadWidth??t.road??"",price:null!=t.pricePerSqw?this.formatMoney(t.pricePerSqw):"",totalPrice:t.totalPrice??"",landFrame:t.landFrame??"",deedInformation:t.deedInformation??"",owner:t.owner??"",agent:t.agent??"",phone:t.phone??"",lineId:t.lineId??""};try{if("Polygon"===t.geometry?.type&&Array.isArray(t.geometry.coordinates)){const e=t.geometry.coordinates.map(([t,e])=>({lon:t,lat:e}));if(this.clearDrawing(),this.drawPoints=e,this.drawPoints.length>=3){try{this.drawPolyline&&this.map.Overlays.remove(this.drawPolyline)}catch(n){}try{this.drawPolygon&&this.map.Overlays.remove(this.drawPolygon)}catch(n){}this.drawPolygon=new window.longdo.Polygon(this.drawPoints,{lineWidth:2,lineColor:"rgba(30,144,255,0.9)",fillColor:"rgba(30,144,255,0.25)"}),this.map.Overlays.add(this.drawPolygon)}}}catch(n){console.debug("selectLand draw error",n)}},onLandOverlayClick(t){this.selectLand(t)}},watch:{availableLayers:{handler(t){const e=t.find(t=>1===t.id);e&&this.toggleMarkersLayer(),console.log("Start pop-up")},deep:!0},"landData.size"(){this.syncFromSize(),this.landData.price&&this.syncPriceFromPerSqw()},raiModel(){this.onRNWInput()},nganModel(){this.onRNWInput()},wahModel(){this.onRNWInput()},"landData.owner"(t){t&&""!==t.trim()&&(this.landData.agent="")},"landData.agent"(t){t&&""!==t.trim()&&(this.landData.owner="")},showDisclaimer(t){document.body.style.overflow=t?"hidden":""}}};const Ke=(0,Be.A)($e,[["render",oe]]);var Ve=Ke,Xe=a(8252),je=a.n(Xe);const Ge=(0,i.Ef)(Ve);Ge.component("RouterView",{name:"RouterViewStub",render(){return null}}),window.__LONGDO_KEY="3013d29eca5230ad752a9dc3c9b4bad1",Ge.use(je(),{load:{apiKey:window.__LONGDO_KEY,language:"th",defer:!1,services:["search"]}}),Ge.mount("#app")}},e={};function a(i){var n=e[i];if(void 0!==n)return n.exports;var l=e[i]={exports:{}};return t[i].call(l.exports,l,l.exports,a),l.exports}a.m=t,function(){var t=[];a.O=function(e,i,n,l){if(!i){var s=1/0;for(d=0;d<t.length;d++){i=t[d][0],n=t[d][1],l=t[d][2];for(var r=!0,o=0;o<i.length;o++)(!1&l||s>=l)&&Object.keys(a.O).every(function(t){return a.O[t](i[o])})?i.splice(o--,1):(r=!1,l<s&&(s=l));if(r){t.splice(d--,1);var c=n();void 0!==c&&(e=c)}}return e}l=l||0;for(var d=t.length;d>0&&t[d-1][2]>l;d--)t[d]=t[d-1];t[d]=[i,n,l]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var i in e)a.o(e,i)&&!a.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={524:0};a.O.j=function(e){return 0===t[e]};var e=function(e,i){var n,l,s=i[0],r=i[1],o=i[2],c=0;if(s.some(function(e){return 0!==t[e]})){for(n in r)a.o(r,n)&&(a.m[n]=r[n]);if(o)var d=o(a)}for(e&&e(i);c<s.length;c++)l=s[c],a.o(t,l)&&t[l]&&t[l][0](),t[l]=0;return a.O(d)},i=self["webpackChunksqw"]=self["webpackChunksqw"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=a.O(void 0,[504],function(){return a(539)});i=a.O(i)})();
//# sourceMappingURL=app.414fe9d3.js.map